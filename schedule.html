<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DeltaV â€” ğŸ—“ï¸ Schedule</title><link rel="stylesheet" href="theme.css"><style></style></head><body><script>if(sessionStorage.getItem("dv_admin")!=="1"){location.href="login.html";}</script><div class="sidebar"><div class="sb-logo">DeltaV <span>Auto</span><small>Admin Panel</small></div><nav><div class="sb-sec">Core</div><a href="dashboard.html" class=""><span class="ni">ğŸ“Š</span>Dashboard</a><a href="admin.html" class=""><span class="ni">ğŸ“…</span>Bookings</a><a href="schedule.html" class="active"><span class="ni">ğŸ—“ï¸</span>Schedule</a><a href="customers.html" class=""><span class="ni">ğŸ‘¥</span>Customers</a><a href="invoices.html" class=""><span class="ni">ğŸ’°</span>Invoices</a><div class="sb-sec">Stock & Money</div><a href="inventory.html" class=""><span class="ni">ğŸ“¦</span>Inventory</a><a href="payments.html" class=""><span class="ni">ğŸ’³</span>Payments</a><a href="finance.html" class=""><span class="ni">ğŸ“ˆ</span>Finance</a><a href="workers.html" class=""><span class="ni">ğŸ‘·</span>Workers</a><div class="sb-sec">Operations</div><a href="jobs.html" class=""><span class="ni">ğŸ”©</span>Job Cards</a><a href="quotes.html" class=""><span class="ni">ğŸ“‹</span>Quotes</a><a href="suppliers.html" class=""><span class="ni">ğŸ­</span>Suppliers</a><a href="expenses.html" class=""><span class="ni">ğŸ§¾</span>Expenses</a><a href="reports.html" class=""><span class="ni">ğŸ“‰</span>Reports</a><div class="sb-sec">Communication</div><a href="messages.html" class=""><span class="ni">ğŸ’¬</span>Messages</a><a href="notes.html" class=""><span class="ni">ğŸ“</span>Notes</a><a href="reminders.html" class=""><span class="ni">ğŸ””</span>Reminders</a><a href="vehicles.html" class=""><span class="ni">ğŸš—</span>Vehicle DB</a><div class="sb-sec">Extra</div><a href="audit.html" class=""><span class="ni">ğŸ”</span>Audit Log</a><a href="tasks.html" class=""><span class="ni">âœ…</span>Tasks</a><a href="timesheets.html" class=""><span class="ni">â±ï¸</span>Timesheets</a><a href="warranties.html" class=""><span class="ni">ğŸ›¡ï¸</span>Warranties</a><a href="promotions.html" class=""><span class="ni">ğŸ</span>Promotions</a><a href="feedback.html" class=""><span class="ni">â­</span>Feedback</a><a href="returns.html" class=""><span class="ni">â†©ï¸</span>Returns</a><a href="waiting.html" class=""><span class="ni">â³</span>Waiting List</a><a href="checklist.html" class=""><span class="ni">â˜‘ï¸</span>Checklists</a><a href="gallery-admin.html" class=""><span class="ni">ğŸ“¸</span>Gallery Mgr</a><a href="targets.html" class=""><span class="ni">ğŸ¯</span>Targets</a><a href="settings.html" class=""><span class="ni">âš™ï¸</span>Settings</a></nav><div class="sb-foot"><a href="index.html" class="btn-sb-link">ğŸŒ Website</a><button class="btn-sb-out" onclick="if(confirm('Log out?')){sessionStorage.removeItem('dv_admin');location.href='login.html';}">ğŸšª Log Out</button></div></div><div class="main"><div class="topbar"><h1>ğŸ—“ï¸ Schedule</h1><div class="tr"><button class="btn btn-ghost" onclick="loadSch()">ğŸ”„ Refresh</button><button class="btn btn-info" onclick="exportSch()">ğŸ“¥ Export</button><a href="admin.html" class="btn btn-dark">ğŸ“… Bookings</a></div></div><div class="body"><div style="display:flex;gap:8px;margin-bottom:16px;align-items:center;flex-wrap:wrap">
  <button class="btn btn-dark" onclick="prevMo()">â† Prev</button>
  <h2 id="moT" style="flex:1;text-align:center;font-family:'Barlow Condensed',sans-serif;font-size:1.5rem;font-weight:700;color:var(--dk)"></h2>
  <button class="btn btn-dark" onclick="nextMo()">Next â†’</button>
  <button class="btn btn-primary" onclick="goTd()">Today</button>
  <button class="btn btn-ghost" onclick="loadSch()">ğŸ”„</button>
</div>
<div class="tbl-wrap" style="overflow:visible">
  <div style="display:grid;grid-template-columns:repeat(7,1fr);background:linear-gradient(135deg,#1b2b3a,#2e4560)">
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">SUN</div>
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">MON</div>
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">TUE</div>
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">WED</div>
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">THU</div>
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">FRI</div>
    <div style="padding:10px;text-align:center;color:rgba(255,255,255,.45);font-size:.64rem;font-weight:700;letter-spacing:1px">SAT</div>
  </div>
  <div id="calGrid" style="display:grid;grid-template-columns:repeat(7,1fr);background:#fff"></div>
</div>
<div class="modal" id="mApt"><div class="mbox"><h3>ğŸ“‹ Appointment</h3><div id="mAptB"></div>
<div class="mfoot"><button class="btn btn-ghost" onclick="closeM('mApt')">Close</button><a href="admin.html" class="btn btn-primary">â†’ Manage</a></div></div></div></div></div><div class="modal" id="mDel"><div class="mbox" style="max-width:370px"><h3>ğŸ—‘ï¸ Confirm Delete</h3><p id="mDelMsg" style="color:#555;margin-bottom:4px">This cannot be undone.</p><div class="mfoot"><button class="btn btn-ghost" onclick="closeM('mDel')">Cancel</button><button class="btn btn-danger" id="mDelBtn">Yes, Delete</button></div></div></div><script src="shared.js"></script><script>
let sMo=new Date().getMonth(),sYr=new Date().getFullYear(),sBks=[];
const MO=["January","February","March","April","May","June","July","August","September","October","November","December"];
async function loadSch(){sBks=await dbGet("bookings");renderCal();}
function renderCal(){
  document.getElementById("moT").textContent=`${MO[sMo]} ${sYr}`;
  const first=new Date(sYr,sMo,1).getDay(),days=new Date(sYr,sMo+1,0).getDate(),td=today();
  const g=document.getElementById("calGrid");g.innerHTML="";
  for(let i=0;i<first;i++){const c=document.createElement("div");c.style="min-height:100px;border:1px solid #f0f2f5;background:#fafafa";g.appendChild(c);}
  for(let d=1;d<=days;d++){
    const ds=`${sYr}-${String(sMo+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const day=sBks.filter(b=>(b.confirmed_date||b.date)===ds);
    const isT=ds===td;
    const c=document.createElement("div");
    c.style=`min-height:100px;border:1px solid ${isT?"var(--ac)":"#f0f2f5"};padding:7px;background:${isT?"#fff5f0":"#fff"}`;
    c.innerHTML=`<div style="font-weight:700;font-size:.82rem;color:${isT?"var(--ac)":"#1b2b3a"};margin-bottom:4px">${d}${isT?` <span style="font-size:.56rem;background:var(--ac);color:#fff;padding:1px 4px;border-radius:3px">TODAY</span>`:""}`;
    day.forEach(b=>{
      const dot=document.createElement("div");
      dot.style=`background:${b.status==="confirmed"?"#28a745":"#ffc107"};color:${b.status==="confirmed"?"#fff":"#333"};padding:2px 6px;border-radius:4px;font-size:.66rem;font-weight:600;margin-bottom:2px;cursor:pointer;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;`;
      dot.textContent=`${b.confirmed_time?fmtT(b.confirmed_time)+" ":""}${b.name}`;
      dot.title=`${b.name} â€” ${b.reg} â€” ${b.service||""}`;
      dot.onclick=()=>{document.getElementById("mAptB").innerHTML=`<div class="ir"><span class="lbl">Customer</span><span class="val">${b.name}</span></div><div class="ir"><span class="lbl">Reg</span><span class="val">${b.reg}</span></div><div class="ir"><span class="lbl">Service</span><span class="val">${b.service||"â€”"}</span></div><div class="ir"><span class="lbl">Time</span><span class="val">${b.confirmed_time?fmtT(b.confirmed_time):"Not set"}</span></div><div class="ir"><span class="lbl">Status</span><span class="val">${b.status}</span></div>`;openM("mApt");};
      c.appendChild(dot);
    });
    g.appendChild(c);
  }
}
function prevMo(){sMo--;if(sMo<0){sMo=11;sYr--;}renderCal();}
function nextMo(){sMo++;if(sMo>11){sMo=0;sYr++;}renderCal();}
function goTd(){sMo=new Date().getMonth();sYr=new Date().getFullYear();renderCal();}
function exportSch(){
  const rows=[["Date","Customer","Reg","Service","Time","Status"]];
  sBks.filter(b=>b.confirmed_date).forEach(b=>rows.push([b.confirmed_date,b.name,b.reg,b.service||"",b.confirmed_time||"",b.status]));
  const csv=rows.map(r=>r.map(c=>`"${c||""}"`).join(",")).join("
");
  const a=document.createElement("a");a.href="data:text/csv,"+encodeURIComponent(csv);a.download="schedule.csv";a.click();
}
loadSch();
</script></body></html>