<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>DeltaV â€” ğŸ‘· Workers</title>
<link rel="stylesheet" href="theme.css">
<style></style>
</head>
<body>
<script>if(sessionStorage.getItem("dv_admin")!=="1"){location.href="login.html";}</script>
<div class="sidebar">
  <div class="sb-logo">DeltaV <span>Auto</span><small>Admin Panel</small></div>
  <nav><div class="sb-sec">Core</div><a href="dashboard.html" class=""><span class="ni">ğŸ“Š</span>Dashboard</a>
<a href="admin.html" class=""><span class="ni">ğŸ“…</span>Bookings</a>
<a href="schedule.html" class=""><span class="ni">ğŸ—“ï¸</span>Schedule</a>
<a href="customers.html" class=""><span class="ni">ğŸ‘¥</span>Customers</a>
<a href="invoices.html" class=""><span class="ni">ğŸ’°</span>Invoices</a>
<div class="sb-sec">Stock & Money</div><a href="inventory.html" class=""><span class="ni">ğŸ“¦</span>Inventory</a>
<a href="payments.html" class=""><span class="ni">ğŸ’³</span>Payments</a>
<a href="finance.html" class=""><span class="ni">ğŸ“ˆ</span>Finance</a>
<a href="workers.html" class="active"><span class="ni">ğŸ‘·</span>Workers</a>
<div class="sb-sec">Operations</div><a href="jobs.html" class=""><span class="ni">ğŸ”©</span>Job Cards</a>
<a href="quotes.html" class=""><span class="ni">ğŸ“‹</span>Quotes</a>
<a href="suppliers.html" class=""><span class="ni">ğŸ­</span>Suppliers</a>
<a href="expenses.html" class=""><span class="ni">ğŸ§¾</span>Expenses</a>
<a href="reports.html" class=""><span class="ni">ğŸ“‰</span>Reports</a>
<div class="sb-sec">Comms & Tools</div><a href="messages.html" class=""><span class="ni">ğŸ’¬</span>Messages</a>
<a href="notes.html" class=""><span class="ni">ğŸ“</span>Notes</a>
<a href="reminders.html" class=""><span class="ni">ğŸ””</span>Reminders</a>
<a href="vehicles.html" class=""><span class="ni">ğŸš—</span>Vehicle DB</a>
<a href="tasks.html" class=""><span class="ni">âœ…</span>Tasks</a>
<a href="timesheets.html" class=""><span class="ni">â±ï¸</span>Timesheets</a>
<div class="sb-sec">Extra</div><a href="warranties.html" class=""><span class="ni">ğŸ›¡ï¸</span>Warranties</a>
<a href="promotions.html" class=""><span class="ni">ğŸ</span>Promotions</a>
<a href="feedback.html" class=""><span class="ni">â­</span>Feedback</a>
<a href="returns.html" class=""><span class="ni">â†©ï¸</span>Returns</a>
<a href="waiting.html" class=""><span class="ni">â³</span>Waiting List</a>
<a href="checklist.html" class=""><span class="ni">â˜‘ï¸</span>Checklists</a>
<a href="targets.html" class=""><span class="ni">ğŸ¯</span>Targets</a>
<a href="audit.html" class=""><span class="ni">ğŸ”</span>Audit Log</a>
<a href="gallery_mgr.html" class=""><span class="ni">ğŸ“¸</span>Gallery Mgr</a>
<div class="sb-sec">Advanced</div><a href="sms.html" class=""><span class="ni">ğŸ“±</span>SMS / Email</a>
<a href="loyalty.html" class=""><span class="ni">ğŸ…</span>Loyalty</a>
<a href="parts_orders.html" class=""><span class="ni">ğŸ›’</span>Parts Orders</a>
<a href="MOT.html" class=""><span class="ni">ğŸ”–</span>MOT Tracker</a>
<a href="service_history.html" class=""><span class="ni">ğŸ“œ</span>Svc History</a>
<a href="staff_rota.html" class=""><span class="ni">ğŸ“†</span>Staff Rota</a>
<a href="hours.html" class=""><span class="ni">â°</span>Opening Hours</a>
<a href="settings.html" class=""><span class="ni">âš™ï¸</span>Settings</a>
</nav>
  <div class="sb-foot">
    <a href="index.html" class="btn-sb-link">ğŸŒ Website</a>
    <button class="btn-sb-out" onclick="if(confirm('Log out?')){sessionStorage.removeItem('dv_admin');location.href='login.html';}">ğŸšª Log Out</button>
  </div>
</div>
<div class="main">
  <div class="topbar"><h1>ğŸ‘· Workers</h1><div class="tr"><button class="btn btn-primary" onclick="openM('mNewW')">+ Add Worker</button><button class="btn btn-info" onclick="exportWorkers()">ğŸ“¥ Export</button><button class="btn btn-ghost" onclick="loadWorkers()">ğŸ”„ Refresh</button></div></div>
  <div class="body">
<div class="stat-grid">
  <div class="card"><div class="card-title">ğŸ‘· Total Staff</div><div class="card-val" id="wTotal">â€”</div></div>
  <div class="card"><div class="card-title">âœ… Active</div><div class="card-val" id="wActive" style="color:var(--ok)">â€”</div></div>
  <div class="card"><div class="card-title">ğŸ’° Monthly Payroll</div><div class="card-val" id="wPay">â€”</div></div>
  <div class="card"><div class="card-title">â±ï¸ Hours This Week</div><div class="card-val" id="wHrs">â€”</div></div>
</div>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px" id="workerGrid"></div>
<div class="empty" id="wEmpty" style="display:none"><div class="ei">ğŸ‘·</div><h3>No Workers Yet</h3></div>

<div class="modal" id="mNewW"><div class="mbox">
  <h3 id="mWTit">ğŸ‘· Add Worker</h3>
  <div class="g2">
    <div class="fg"><label>Full Name *</label><input type="text" id="wName" placeholder="Jane Smith"></div>
    <div class="fg"><label>Role *</label>
      <select id="wRole"><option>Lead Mechanic</option><option>Mechanic</option><option>Apprentice</option><option>Body Shop Tech</option><option>Electrician</option><option>Service Manager</option><option>Receptionist</option><option>Cleaner</option><option>Other</option></select>
    </div>
  </div>
  <div class="g2">
    <div class="fg"><label>Phone</label><input type="tel" id="wPhone" placeholder="07700 000000"></div>
    <div class="fg"><label>Email</label><input type="email" id="wEmail" placeholder="jane@example.com"></div>
  </div>
  <div class="g2">
    <div class="fg"><label>Hourly Rate (Â£)</label><input type="number" id="wRate" placeholder="12.50" min="0" step="0.01"></div>
    <div class="fg"><label>Contract Hours/Week</label><input type="number" id="wHours" placeholder="40" min="0"></div>
  </div>
  <div class="g2">
    <div class="fg"><label>Start Date</label><input type="date" id="wStart"></div>
    <div class="fg"><label>Status</label>
      <select id="wStatus"><option value="active">Active</option><option value="part-time">Part-Time</option><option value="on-leave">On Leave</option><option value="left">Left</option></select>
    </div>
  </div>
  <div class="fg"><label>Qualifications / Notes</label><textarea id="wNotes"></textarea></div>
  <div class="mfoot">
    <button class="btn btn-ghost" onclick="closeM('mNewW')">Cancel</button>
    <button class="btn btn-primary" onclick="saveWorker()">ğŸ’¾ Save Worker</button>
  </div>
</div></div>

<div class="modal" id="mWView"><div class="mbox"><h3>ğŸ‘¤ Worker Profile</h3><div id="mWViewB"></div>
  <div class="mfoot">
    <button class="btn btn-ghost" onclick="closeM('mWView')">Close</button>
    <button class="btn btn-warning" onclick="closeM('mWView');openM('mNewW')">âœï¸ Edit</button>
    <a href="timesheets.html" class="btn btn-info">â±ï¸ Timesheets</a>
  </div>
</div></div>
</div>
</div>
<div class="modal" id="mDel"><div class="mbox" style="max-width:360px">
  <h3>ğŸ—‘ï¸ Confirm Delete</h3>
  <p id="mDelMsg" style="color:#555;margin-bottom:4px">This cannot be undone.</p>
  <div class="mfoot">
    <button class="btn btn-ghost" onclick="closeM('mDel')">Cancel</button>
    <button class="btn btn-danger" id="mDelBtn">Yes, Delete</button>
  </div>
</div></div>
<script src="shared.js"></script>
<script>
let wData=[],wEdit=null;
async function loadWorkers(){wData=await dbGet("workers");renderWorkers();updateWStats();}
function updateWStats(){
  document.getElementById("wTotal").textContent=wData.length;
  document.getElementById("wActive").textContent=wData.filter(w=>w.status==="active").length;
  const pay=wData.filter(w=>w.status==="active").reduce((s,w)=>s+((w.hourly_rate||0)*(w.contract_hours||0)*52/12),0);
  document.getElementById("wPay").textContent=fmtGBP(pay);
  document.getElementById("wHrs").textContent=wData.filter(w=>w.status==="active").reduce((s,w)=>s+(w.contract_hours||0),0)+"h";
}
function renderWorkers(){
  const g=document.getElementById("workerGrid");g.innerHTML="";
  document.getElementById("wEmpty").style.display=wData.length?"none":"block";
  wData.forEach(w=>{
    const sc=w.status==="active"?"b-ok":w.status==="on-leave"?"b-wa":"b-dk";
    const card=document.createElement("div");
    card.style="background:#fff;border-radius:var(--r);border:1.5px solid var(--br);box-shadow:var(--s2);overflow:hidden;transition:all .2s";
    card.innerHTML=`<div style="background:linear-gradient(135deg,#1b2b3a,#2e4560);padding:16px;display:flex;align-items:center;gap:12px">
      <div style="width:48px;height:48px;background:var(--ac);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0">ğŸ‘¤</div>
      <div><div style="color:#fff;font-weight:700;font-size:.94rem">${w.name}</div><div style="color:rgba(255,255,255,.55);font-size:.78rem">${w.role||"â€”"}</div></div>
    </div>
    <div style="padding:14px">
      <div class="ir"><span class="lbl">ğŸ“</span><span class="val">${w.phone||"â€”"}</span></div>
      <div class="ir"><span class="lbl">ğŸ’° Rate</span><span class="val">${w.hourly_rate?"Â£"+w.hourly_rate+"/hr":"â€”"}</span></div>
      <div class="ir"><span class="lbl">â±ï¸ Hours</span><span class="val">${w.contract_hours?w.contract_hours+"h/wk":"â€”"}</span></div>
      <div style="margin-top:8px"><span class="badge ${sc}">${(w.status||"active").toUpperCase()}</span></div>
    </div>
    <div style="padding:8px 14px;border-top:1.5px solid #eef0f3;display:flex;gap:6px;flex-wrap:wrap">
      <button class="btn btn-dark btn-sm" onclick="viewWorker('${w.id}')">ğŸ‘¤ Profile</button>
      <button class="btn btn-warning btn-sm" onclick="editWorker('${w.id}')">âœï¸ Edit</button>
      <a href="tel:${w.phone||""}" class="btn btn-success btn-sm">ğŸ“ Call</a>
      <a href="mailto:${w.email||""}" class="btn btn-info btn-sm">ğŸ“§</a>
      <button class="btn btn-danger btn-sm" onclick="delWorker('${w.id}')">ğŸ—‘ï¸</button>
    </div>`;
    g.appendChild(card);
  });
}
function viewWorker(id){const w=wData.find(x=>x.id===id);if(!w)return;document.getElementById("mWViewB").innerHTML=`<div class="ir"><span class="lbl">Name</span><span class="val">${w.name}</span></div><div class="ir"><span class="lbl">Role</span><span class="val">${w.role||"â€”"}</span></div><div class="ir"><span class="lbl">Phone</span><span class="val">${w.phone||"â€”"}</span></div><div class="ir"><span class="lbl">Email</span><span class="val">${w.email||"â€”"}</span></div><div class="ir"><span class="lbl">Hourly Rate</span><span class="val">${w.hourly_rate?"Â£"+w.hourly_rate+"/hr":"â€”"}</span></div><div class="ir"><span class="lbl">Contract Hours</span><span class="val">${w.contract_hours?w.contract_hours+"h/week":"â€”"}</span></div><div class="ir"><span class="lbl">Est. Monthly Pay</span><span class="val" style="color:var(--ac);font-weight:700">${fmtGBP((w.hourly_rate||0)*(w.contract_hours||0)*52/12)}</span></div><div class="ir"><span class="lbl">Start Date</span><span class="val">${w.start_date?fmtD(w.start_date):"â€”"}</span></div><div class="ir"><span class="lbl">Status</span><span class="val">${w.status||"active"}</span></div>${w.notes?`<div class="ir"><span class="lbl">Notes</span><span class="val">${w.notes}</span></div>`:""}`;openM("mWView");}
function editWorker(id){const w=wData.find(x=>x.id===id);if(!w)return;wEdit=id;document.getElementById("mWTit").textContent="âœï¸ Edit Worker";document.getElementById("wName").value=w.name;document.getElementById("wRole").value=w.role||"Mechanic";document.getElementById("wPhone").value=w.phone||"";document.getElementById("wEmail").value=w.email||"";document.getElementById("wRate").value=w.hourly_rate||"";document.getElementById("wHours").value=w.contract_hours||"";document.getElementById("wStart").value=w.start_date||"";document.getElementById("wStatus").value=w.status||"active";document.getElementById("wNotes").value=w.notes||"";openM("mNewW");}
async function saveWorker(){const n=document.getElementById("wName").value.trim();if(!n){toast("Name required","er");return;}const d={name:n,role:document.getElementById("wRole").value,phone:document.getElementById("wPhone").value.trim()||null,email:document.getElementById("wEmail").value.trim()||null,hourly_rate:parseFloat(document.getElementById("wRate").value)||null,contract_hours:parseInt(document.getElementById("wHours").value)||null,start_date:document.getElementById("wStart").value||null,status:document.getElementById("wStatus").value,notes:document.getElementById("wNotes").value.trim()||null};if(wEdit){await dbUpd("workers",wEdit,d);toast("Updated!");}else{await dbIns("workers",d);toast("Worker added!");}wEdit=null;closeM("mNewW");loadWorkers();}
function delWorker(id){confirmDel("Remove this worker?",async()=>{await dbDel("workers",id);wData=wData.filter(w=>w.id!==id);renderWorkers();updateWStats();toast("Removed","in");});}
function exportWorkers(){const rows=[["Name","Role","Phone","Email","Rate","Hours/Wk","Start","Status"]];wData.forEach(w=>rows.push([w.name,w.role||"",w.phone||"",w.email||"",w.hourly_rate||"",w.contract_hours||"",w.start_date||"",w.status||""]));const csv=rows.map(r=>r.map(c=>`"${c||""}"`).join(",")).join("
");const a=document.createElement("a");a.href="data:text/csv,"+encodeURIComponent(csv);a.download="workers.csv";a.click();}
document.getElementById("wStart").value=today();loadWorkers();
</script>
</body></html>