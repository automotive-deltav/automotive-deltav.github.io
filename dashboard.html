<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard - DeltaV</title>
<link rel="stylesheet" href="theme.css">
</head><body>
<script>if(sessionStorage.getItem("dv_admin")!=="1")location.href="login.html";</script>
<div class="sidebar">
  <div class="sb-logo">DeltaV <span>Auto</span><small>Admin Panel</small></div>
  <nav>
    <div class="sb-sec">Core</div>
    <a href="dashboard.html" class="active"><span class="ni">ğŸ“Š</span>Dashboard</a>
    <a href="admin.html"><span class="ni">ğŸ“…</span>Bookings</a>
    <a href="schedule.html"><span class="ni">ğŸ—“ï¸</span>Schedule</a>
    <a href="customers.html"><span class="ni">ğŸ‘¥</span>Customers</a>
    <a href="contact_inquiries.html"><span class="ni">ğŸ“§</span>Contact Inquiries</a>
    <a href="invoices.html"><span class="ni">ğŸ’°</span>Invoices</a>

    <div class="sb-sec">Stock & Money</div>
    <a href="inventory.html"><span class="ni">ğŸ“¦</span>Inventory</a>
    <a href="payments.html"><span class="ni">ğŸ’³</span>Payments</a>
    <a href="finance.html"><span class="ni">ğŸ“ˆ</span>Finance</a>
    <a href="workers.html"><span class="ni">ğŸ‘·</span>Workers</a>

    <div class="sb-sec">Operations</div>
    <a href="jobs.html"><span class="ni">ğŸ”©</span>Job Cards</a>
    <a href="quotes.html"><span class="ni">ğŸ“‹</span>Quotes</a>
    <a href="suppliers.html"><span class="ni">ğŸ­</span>Suppliers</a>
    <a href="expenses.html"><span class="ni">ğŸ§¾</span>Expenses</a>
    <a href="reports.html"><span class="ni">ğŸ“‰</span>Reports</a>

    <div class="sb-sec">Communication</div>
    <a href="messages.html"><span class="ni">ğŸ’¬</span>Messages</a>
    <a href="notes.html"><span class="ni">ğŸ“</span>Notes</a>
    <a href="reminders.html"><span class="ni">ğŸ””</span>Reminders</a>
    <a href="vehicles.html"><span class="ni">ğŸš—</span>Vehicle DB</a>

    <div class="sb-sec">Extra</div>
    <a href="audit.html"><span class="ni">ğŸ”</span>Audit Log</a>
    <a href="tasks.html"><span class="ni">âœ…</span>Tasks</a>
    <a href="timesheets.html"><span class="ni">â±ï¸</span>Timesheets</a>
    <a href="warranties.html"><span class="ni">ğŸ›¡ï¸</span>Warranties</a>
    <a href="promotions.html"><span class="ni">ğŸ</span>Promotions</a>
    <a href="feedback.html"><span class="ni">â­</span>Feedback</a>
    <a href="returns.html"><span class="ni">â†©ï¸</span>Returns</a>
    <a href="waiting.html"><span class="ni">â³</span>Waiting List</a>
    <a href="checklist.html"><span class="ni">â˜‘ï¸</span>Checklists</a>
    <a href="gallery_mgr.html"><span class="ni">ğŸ“¸</span>Gallery Mgr</a>
    <a href="targets.html"><span class="ni">ğŸ¯</span>Targets</a>
    <a href="settings.html"><span class="ni">âš™ï¸</span>Settings</a>
  </nav>
  <div class="sb-foot">
    <a href="index.html" class="btn-sb-link">ğŸŒ Website</a>
    <button class="btn-sb-out" onclick="if(confirm('Log out?')){sessionStorage.removeItem('dv_admin');location.href='login.html';}">ğŸšª Log Out</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <h1>ğŸ“Š Dashboard</h1>
    <div class="tr">
      <button class="btn btn-ghost" onclick="loadDash()">ğŸ”„ Refresh</button>
      <button class="btn btn-ghost" onclick="showKeyboardHelp()">âŒ¨ï¸ Shortcuts</button>
    </div>
  </div>
  <div class="body">
    <div class="stat-grid">
      <div class="stat-card">
        <span class="stat-icon">ğŸ“…</span>
        <div class="stat-label">Total Bookings</div>
        <div class="stat-value" id="statBookings">0</div>
        <div class="stat-sub">ğŸ“ˆ This month</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ­</span>
        <div class="stat-label">Suppliers</div>
        <div class="stat-value" id="statSuppliers">0</div>
        <div class="stat-sub">âœ“ Active</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸš—</span>
        <div class="stat-label">Vehicles</div>
        <div class="stat-value" id="statVehicles">0</div>
        <div class="stat-sub">ğŸ“‹ In system</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">âœ…</span>
        <div class="stat-label">Active Tasks</div>
        <div class="stat-value" id="statTasks">0</div>
        <div class="stat-sub">â³ Pending</div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:28px">
      <div class="card">
        <h3 style="margin-bottom:20px;font-family:'Barlow Condensed',sans-serif;font-size:1.4rem;color:var(--dk)">ğŸ“… Recent Bookings</h3>
        <div id="recentBookings"></div>
      </div>
      <div class="card">
        <h3 style="margin-bottom:20px;font-family:'Barlow Condensed',sans-serif;font-size:1.4rem;color:var(--dk)">âœ… Upcoming Tasks</h3>
        <div id="upcomingTasks"></div>
      </div>
    </div>
  </div>
</div>
<script src="shared.js"></script>
<script>
async function loadDash(){
  try{
    const [bookings,suppliers,vehicles,tasks]=await Promise.all([
      dbGet("bookings","&order=date.desc&limit=5"),
      dbGet("suppliers"),
      dbGet("vehicles"),
      dbGet("tasks","&order=id.desc&limit=5")
    ]);
  
  // Animate stat values
  animateStat("statBookings",bookings.length);
  animateStat("statSuppliers",suppliers.length);
  animateStat("statVehicles",vehicles.length);
  animateStat("statTasks",tasks.length);
  
  // Render recent bookings with animations
  const rb=document.getElementById("recentBookings");
  if(!bookings.length)rb.innerHTML='<p style="color:#94a3b8;text-align:center;padding:40px">No bookings yet</p>';
  else {
    rb.innerHTML='';
    bookings.slice(0,5).forEach((b,i)=>{
      const item=document.createElement('div');
      item.style.cssText='padding:14px;border-bottom:1px solid #f1f3f5;display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:all .2s;animation:fadeInUp .3s ease-out '+(i*0.05)+'s backwards';
      item.onmouseover=function(){this.style.backgroundColor='rgba(255,102,0,.05)';this.style.paddingLeft='20px';}
      item.onmouseout=function(){this.style.backgroundColor='';this.style.paddingLeft='14px';}
      item.innerHTML=`<div><strong style="color:var(--dk)">${b.name}</strong><br><small style="color:#94a3b8">${b.reg} â€¢ ${b.service||'General'}</small></div>
        <span style="font-size:.8rem;color:#64748b;background:#f8f9fb;padding:4px 8px;border-radius:4px">${b.date}</span>`;
      rb.appendChild(item);
    });
  }
  
  // Render upcoming tasks with animations
  const ut=document.getElementById("upcomingTasks");
  if(!tasks.length)ut.innerHTML='<p style="color:#94a3b8;text-align:center;padding:40px">No pending tasks</p>';
  else {
    ut.innerHTML='';
    tasks.slice(0,5).forEach((t,i)=>{
      const item=document.createElement('div');
      item.style.cssText='padding:14px;border-bottom:1px solid #f1f3f5;cursor:pointer;transition:all .2s;animation:fadeInUp .3s ease-out '+(i*0.05)+'s backwards;border-left:3px solid '+(t.priority==='high'?'var(--er)':'var(--ok)')+';margin-bottom:4px';
      item.onmouseover=function(){this.style.backgroundColor='rgba(255,102,0,.05)';this.style.paddingLeft='20px';}
      item.onmouseout=function(){this.style.backgroundColor='';this.style.paddingLeft='14px';}
      item.innerHTML=`<strong style="color:var(--dk)">${t.task_name}</strong><br>
        <small style="color:#94a3b8">${t.assigned_to||'Unassigned'} â€¢ ${t.due_date||'No deadline'}</small>`;
      ut.appendChild(item);
    });
  }
}catch(e){
  console.error("Dashboard load error:",e);
  document.getElementById("statBookings").textContent="?";
  document.getElementById("statSuppliers").textContent="?";
  document.getElementById("statVehicles").textContent="?";
  document.getElementById("statTasks").textContent="?";
}
}

function animateStat(id,target){
  const el=document.getElementById(id);
  const current=parseInt(el.textContent)||0;
  const step=(target-current)/20;
  let count=current;
  const interval=setInterval(()=>{
    count+=step;
    if((step>0&&count>=target)||(step<0&&count<=target)){
      el.textContent=target;
      clearInterval(interval);
    }else{
      el.textContent=Math.round(count);
    }
  },50);
}
loadDash();
</script>
</body></html>