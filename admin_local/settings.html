<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DeltaV — ⚙️ Settings</title><link rel="stylesheet" href="theme.css"><style></style></head><body><div class="sidebar">
  <div class="sb-logo">DeltaV <span>Auto</span><small>Admin Panel</small></div>
  <nav>
    <div class="sb-sec">Core</div>
    <a href="dashboard.html" class=""><span class="ni">📊</span>Dashboard</a>
    <a href="admin.html" class=""><span class="ni">📅</span>Bookings</a>
    <a href="schedule.html" class=""><span class="ni">🗓️</span>Schedule</a>
    <a href="customers.html" class=""><span class="ni">👥</span>Customers</a>
    <a href="contact_inquiries.html" class=""><span class="ni">📧</span>Contact Inquiries</a>
    <a href="invoices.html" class=""><span class="ni">💰</span>Invoices</a>

    <div class="sb-sec">Stock & Money</div>
    <a href="inventory.html" class=""><span class="ni">📦</span>Inventory</a>
    <a href="payments.html" class=""><span class="ni">💳</span>Payments</a>
    <a href="finance.html" class=""><span class="ni">📈</span>Finance</a>
    <a href="workers.html" class=""><span class="ni">👷</span>Workers</a>

    <div class="sb-sec">Operations</div>
    <a href="jobs.html" class=""><span class="ni">🔩</span>Job Cards</a>
    <a href="quotes.html" class=""><span class="ni">📋</span>Quotes</a>
    <a href="suppliers.html" class=""><span class="ni">🏭</span>Suppliers</a>
    <a href="expenses.html" class=""><span class="ni">🧾</span>Expenses</a>
    <a href="reports.html" class=""><span class="ni">📉</span>Reports</a>

    <div class="sb-sec">Comms & Tools</div>
    <a href="messages.html" class=""><span class="ni">💬</span>Messages</a>
    <a href="notes.html" class=""><span class="ni">📝</span>Notes</a>
    <a href="reminders.html" class=""><span class="ni">🔔</span>Reminders</a>
    <a href="vehicles.html" class=""><span class="ni">🚗</span>Vehicle DB</a>
    <a href="tasks.html" class=""><span class="ni">✅</span>Tasks</a>
    <a href="timesheets.html" class=""><span class="ni">⏱️</span>Timesheets</a>

    <div class="sb-sec">Extra</div>
    <a href="warranties.html" class=""><span class="ni">🛡️</span>Warranties</a>
    <a href="promotions.html" class=""><span class="ni">🎁</span>Promotions</a>
    <a href="feedback.html" class=""><span class="ni">⭐</span>Feedback</a>
    <a href="returns.html" class=""><span class="ni">↩️</span>Returns</a>
    <a href="waiting.html" class=""><span class="ni">⏳</span>Waiting List</a>
    <a href="checklist.html" class=""><span class="ni">☑️</span>Checklists</a>
    <a href="targets.html" class=""><span class="ni">🎯</span>Targets</a>
    <a href="audit.html" class=""><span class="ni">🔍</span>Audit Log</a>
    <a href="gallery_mgr.html" class=""><span class="ni">📸</span>Gallery Mgr</a>

    <div class="sb-sec">Advanced</div>
    <a href="sms.html" class=""><span class="ni">📱</span>SMS / Email</a>
    <a href="loyalty.html" class=""><span class="ni">🏅</span>Loyalty</a>
    <a href="parts_orders.html" class=""><span class="ni">🛒</span>Parts Orders</a>
    <a href="MOT.html" class=""><span class="ni">🔖</span>MOT Tracker</a>
    <a href="service_history.html" class=""><span class="ni">📜</span>Svc History</a>
    <a href="staff_rota.html" class=""><span class="ni">📆</span>Staff Rota</a>
    <a href="hours.html" class=""><span class="ni">⏰</span>Opening Hours</a>
    <a href="settings.html" class="active"><span class="ni">⚙️</span>Settings</a>
  </nav>
  <div class="sb-foot">
    <a href="index.html" class="btn-sb-link">🌐 Website</a>
    <button class="btn-sb-out" onclick="if(confirm('Log out?')){sessionStorage.removeItem('dv_admin');location.href='login.html';}">🚪 Log Out</button>
  </div>
</div>
<div class="main"><div class="topbar"><h1>⚙️ Settings</h1><div class="tr"><button class="btn btn-primary" onclick="saveSettings()">💾 Save All Settings</button><button class="btn btn-warning" onclick="resetSettings()">🔄 Reset Defaults</button></div></div><div class="body"><div class="card-flat" style="max-width:700px">
  <h3 style="margin-bottom:18px">⚙️ Garage Settings</h3>
  
  <div class="fg"><label>Garage Name</label><input type="text" id="sName" value="DeltaV Automotive"></div>
  <div class="g2">
    <div class="fg"><label>Phone</label><input type="tel" id="sPhone" value="0121 5650888"></div>
    <div class="fg"><label>Email</label><input type="email" id="sEmail" value="automotive.deltav@yahoo.com"></div>
  </div>
  <div class="fg"><label>Address</label><textarea id="sAddr" rows="3">106 Rolfe Street
Smethwick, West Midlands, B66 2B4</textarea></div>
  
  <div class="divider"></div>
  <h3 style="margin-bottom:14px">💳 Payment Settings</h3>
  <div class="fg"><label>VAT Registration Number</label><input type="text" id="sVAT" value="GB XXX XXXX XX"></div>
  <div class="tog-row"><label>Apply VAT by default (20%)</label><label class="tog"><input type="checkbox" id="sVATDef" checked><span class="tog-sl"></span></label></div>
  <div class="fg"><label>Bank Name</label><input type="text" id="sBank" value="Example Bank"></div>
  <div class="g2">
    <div class="fg"><label>Sort Code</label><input type="text" id="sSort" value="00-00-00"></div>
    <div class="fg"><label>Account Number</label><input type="text" id="sAcc" value="12345678"></div>
  </div>
  
  <div class="divider"></div>
  <h3 style="margin-bottom:14px">📧 Email Settings (EmailJS)</h3>
  <p style="color:#888;font-size:.84rem;margin-bottom:12px">Configure EmailJS to send booking verification emails. Works with ALL email providers (Gmail, Outlook, Yahoo, etc.)</p>
  <div class="fg"><label>EmailJS Public Key</label><input type="text" id="sEJKey" placeholder="YOUR_EMAILJS_PUBLIC_KEY"></div>
  <div class="g2">
    <div class="fg"><label>Service ID</label><input type="text" id="sEJSrv" value="service_hi4mpao"></div>
    <div class="fg"><label>Template ID</label><input type="text" id="sEJTmp" value="template_aj5l14u"></div>
  </div>
  
  <div class="divider"></div>
  <h3 style="margin-bottom:14px">� Admin Account</h3>
  <div class="fg"><label>Admin Username</label><input type="text" id="sUser" value="admin" disabled></div>
  <div class="fg"><label>Change Password</label><input type="password" id="sPass" placeholder="Leave blank to keep current"></div>
  
  <div class="divider"></div>
  <h3 style="margin-bottom:14px">🎨 Preferences</h3>
  <div class="tog-row"><label>Auto-refresh dashboard (30s)</label><label class="tog"><input type="checkbox" id="sDashRef" checked><span class="tog-sl"></span></label></div>
  <div class="tog-row"><label>Auto-mark bookings as viewed</label><label class="tog"><input type="checkbox" id="sAutoView" checked><span class="tog-sl"></span></label></div>
  <div class="tog-row"><label>Send email confirmation on booking</label><label class="tog"><input type="checkbox" id="sEmailConf" checked><span class="tog-sl"></span></label></div>
  
  <button class="btn btn-primary btn-lg btn-fw" onclick="saveSettings()" style="margin-top:20px">💾 Save All Settings</button>
</div></div></div><div class="modal" id="mDel"><div class="mbox" style="max-width:360px"><h3>🗑️ Confirm Delete</h3><p id="mDelMsg" style="color:#555">This cannot be undone.</p><div class="mfoot"><button class="btn btn-ghost" onclick="closeM('mDel')">Cancel</button><button class="btn btn-danger" id="mDelBtn">Yes, Delete</button></div></div></div><script src="shared.js"></script><script>
function saveSettings(){
  const settings={
    name:document.getElementById("sName").value,
    phone:document.getElementById("sPhone").value,
    email:document.getElementById("sEmail").value,
    address:document.getElementById("sAddr").value,
    vat:document.getElementById("sVAT").value,
    vat_default:document.getElementById("sVATDef").checked,
    bank:document.getElementById("sBank").value,
    sort:document.getElementById("sSort").value,
    account:document.getElementById("sAcc").value,
    emailjs_key:document.getElementById("sEJKey").value,
    emailjs_service:document.getElementById("sEJSrv").value,
    emailjs_template:document.getElementById("sEJTmp").value,
    dash_refresh:document.getElementById("sDashRef").checked,
    auto_view:document.getElementById("sAutoView").checked,
    email_confirm:document.getElementById("sEmailConf").checked
  };
  localStorage.setItem("dv_settings",JSON.stringify(settings));
  // Sync ALL company data to Supabase
  const companyData = {
    name: settings.name,
    phone: settings.phone,
    email: settings.email,
    address: settings.address,
    vat: settings.vat
  };
  saveCompanySettingsToDB(companyData).then(()=>{
    toast("Settings saved to Supabase!","ok");
  }).catch(err=>{
    toast("Error saving to Supabase: "+err.message,"error");
    console.error('Supabase save failed',err);
  });
  setCompanySettings(companyData);
  
  const newPass=document.getElementById("sPass").value;
  if(newPass){
    if(confirm("Change admin password to: "+newPass+"?")){
      localStorage.setItem("dv_admin_pass",newPass);
      toast("Password changed! Remember it!","ok");
    }
  }
}

function resetSettings(){
  if(confirm("Reset all settings to defaults?")){
    localStorage.removeItem("dv_settings");
    location.reload();
  }
}

// Load saved settings
const saved=localStorage.getItem("dv_settings");
if(saved){
  try{
    const s=JSON.parse(saved);
    if(s.name)document.getElementById("sName").value=s.name;
    if(s.phone)document.getElementById("sPhone").value=s.phone;
    if(s.email)document.getElementById("sEmail").value=s.email;
    if(s.address)document.getElementById("sAddr").value=s.address;
    if(s.vat)document.getElementById("sVAT").value=s.vat;
    // Sync company data from settings
    setCompanySettings({
      name: s.name,
      phone: s.phone,
      email: s.email,
      address: s.address,
      vat: s.vat
    });
    if(s.vat_default!==undefined)document.getElementById("sVATDef").checked=s.vat_default;
    if(s.bank)document.getElementById("sBank").value=s.bank;
    if(s.sort)document.getElementById("sSort").value=s.sort;
    if(s.account)document.getElementById("sAcc").value=s.account;
    if(s.emailjs_key)document.getElementById("sEJKey").value=s.emailjs_key;
    if(s.emailjs_service)document.getElementById("sEJSrv").value=s.emailjs_service;
    if(s.emailjs_template)document.getElementById("sEJTmp").value=s.emailjs_template;
    if(s.dash_refresh!==undefined)document.getElementById("sDashRef").checked=s.dash_refresh;
    if(s.auto_view!==undefined)document.getElementById("sAutoView").checked=s.auto_view;
    if(s.email_confirm!==undefined)document.getElementById("sEmailConf").checked=s.email_confirm;
  }catch(e){console.error(e)}
}
</script></body></html>