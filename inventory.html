<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DeltaV â€” ğŸ“¦ Inventory</title><link rel="stylesheet" href="theme.css"><style></style></head><body><script>if(sessionStorage.getItem("dv_admin")!=="1"){location.href="login.html";}</script><div class="sidebar"><div class="sb-logo">DeltaV <span>Auto</span><small>Admin Panel</small></div><nav><div class="sb-sec">Core</div><a href="dashboard.html" class=""><span class="ni">ğŸ“Š</span>Dashboard</a><a href="admin.html" class=""><span class="ni">ğŸ“…</span>Bookings</a><a href="schedule.html" class=""><span class="ni">ğŸ—“ï¸</span>Schedule</a><a href="customers.html" class=""><span class="ni">ğŸ‘¥</span>Customers</a><a href="invoices.html" class=""><span class="ni">ğŸ’°</span>Invoices</a><div class="sb-sec">Stock & Money</div><a href="inventory.html" class="active"><span class="ni">ğŸ“¦</span>Inventory</a><a href="payments.html" class=""><span class="ni">ğŸ’³</span>Payments</a><a href="finance.html" class=""><span class="ni">ğŸ“ˆ</span>Finance</a><a href="workers.html" class=""><span class="ni">ğŸ‘·</span>Workers</a><div class="sb-sec">Operations</div><a href="jobs.html" class=""><span class="ni">ğŸ”©</span>Job Cards</a><a href="quotes.html" class=""><span class="ni">ğŸ“‹</span>Quotes</a><a href="suppliers.html" class=""><span class="ni">ğŸ­</span>Suppliers</a><a href="expenses.html" class=""><span class="ni">ğŸ§¾</span>Expenses</a><a href="reports.html" class=""><span class="ni">ğŸ“‰</span>Reports</a><div class="sb-sec">Communication</div><a href="messages.html" class=""><span class="ni">ğŸ’¬</span>Messages</a><a href="notes.html" class=""><span class="ni">ğŸ“</span>Notes</a><a href="reminders.html" class=""><span class="ni">ğŸ””</span>Reminders</a><a href="vehicles.html" class=""><span class="ni">ğŸš—</span>Vehicle DB</a><div class="sb-sec">Extra</div><a href="audit.html" class=""><span class="ni">ğŸ”</span>Audit Log</a><a href="tasks.html" class=""><span class="ni">âœ…</span>Tasks</a><a href="timesheets.html" class=""><span class="ni">â±ï¸</span>Timesheets</a><a href="warranties.html" class=""><span class="ni">ğŸ›¡ï¸</span>Warranties</a><a href="promotions.html" class=""><span class="ni">ğŸ</span>Promotions</a><a href="feedback.html" class=""><span class="ni">â­</span>Feedback</a><a href="returns.html" class=""><span class="ni">â†©ï¸</span>Returns</a><a href="waiting.html" class=""><span class="ni">â³</span>Waiting List</a><a href="checklist.html" class=""><span class="ni">â˜‘ï¸</span>Checklists</a><a href="gallery-admin.html" class=""><span class="ni">ğŸ“¸</span>Gallery Mgr</a><a href="targets.html" class=""><span class="ni">ğŸ¯</span>Targets</a><a href="settings.html" class=""><span class="ni">âš™ï¸</span>Settings</a></nav><div class="sb-foot"><a href="index.html" class="btn-sb-link">ğŸŒ Website</a><button class="btn-sb-out" onclick="if(confirm('Log out?')){sessionStorage.removeItem('dv_admin');location.href='login.html';}">ğŸšª Log Out</button></div></div><div class="main"><div class="topbar"><h1>ğŸ“¦ Inventory</h1><div class="tr"><button class="btn btn-success" onclick="openNewPart()">+ Add Part</button><button class="btn btn-info" onclick="exportInvt()">ğŸ“¥ Export</button><button class="btn btn-ghost" onclick="loadInvt()">ğŸ”„ Refresh</button></div></div><div class="body"><div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center">
  <div class="srch-w"><input type="text" id="invtsrch" placeholder="Search parts, codes, regs..." oninput="renderInvt()"></div>
  <select id="invtSt" class="btn btn-ghost" onchange="renderInvt()" style="padding:9px 12px;font-size:.82rem"><option value="">All Statuses</option><option value="active">In Stock</option><option value="sold">Sold</option><option value="returned">Returned</option><option value="damaged">Damaged</option></select>
  <button class="btn btn-ghost btn-sm" onclick="loadInvt()">ğŸ”„</button>
  <button class="btn btn-info btn-sm" onclick="exportInvt()">ğŸ“¥ CSV</button>
  <button class="btn btn-warning btn-sm" onclick="window.print()">ğŸ–¨ï¸ Print</button>
  <button class="btn btn-dark btn-sm" onclick="stockReport()">ğŸ“Š Stock Report</button>
</div>
<div class="tbl-wrap"><table><thead><tr><th>Code</th><th>Part Name</th><th>Supplier</th><th>Car Reg</th><th>VIN (opt.)</th><th>Serial No.</th><th>Cost</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
<tbody id="invtTb"></tbody></table></div>
<div class="modal" id="mPart"><div class="mbox" style="max-width:720px"><h3 id="mPartTit">ğŸ“¦ Add Part</h3>
<div class="g3">
  <div class="fg ac-w"><label>Item Code *</label><input type="text" id="ptCode" placeholder="P-001"></div>
  <div class="fg"><label>Item Name *</label><input type="text" id="ptName" placeholder="Brake Pads â€” Front Axle"></div>
  <div class="fg"><label>Purchase Date *</label><input type="date" id="ptDt"></div>
</div>
<div class="g3">
  <div class="fg ac-w"><label>Supplier</label><input type="text" id="ptSup" placeholder="Euro Car Parts"></div>
  <div class="fg"><label>Cost Price (Â£) *</label><input type="number" id="ptCost" placeholder="0.00" min="0" step="0.01"></div>
  <div class="fg"><label>Status</label><select id="ptStat"><option value="active">In Stock</option><option value="sold">Sold</option><option value="returned">Returned</option><option value="damaged">Damaged</option></select></div>
</div>
<div class="g3">
  <div class="fg"><label>Serial Number</label><input type="text" id="ptSN" placeholder="SN-XXXXXX"></div>
  <div class="fg"><label>Car Registration (optional)</label><input type="text" id="ptReg" placeholder="AB12 CDE"></div>
  <div class="fg"><label>VIN Number (optional)</label><input type="text" id="ptVIN" placeholder="WBA3A5C50CF256651"></div>
</div>
<div class="fg"><label>Notes</label><textarea id="ptNotes" placeholder="Any notes about this part..."></textarea></div>
<div class="mfoot"><button class="btn btn-ghost" onclick="closeM('mPart')">Cancel</button><button class="btn btn-success" onclick="savePart()">ğŸ’¾ Save</button></div></div></div></div></div><div class="modal" id="mDel"><div class="mbox" style="max-width:370px"><h3>ğŸ—‘ï¸ Confirm Delete</h3><p id="mDelMsg" style="color:#555;margin-bottom:4px">This cannot be undone.</p><div class="mfoot"><button class="btn btn-ghost" onclick="closeM('mDel')">Cancel</button><button class="btn btn-danger" id="mDelBtn">Yes, Delete</button></div></div></div><script src="shared.js"></script><script>
let invtData=[],invtEdit=null,pCodes=[],pNames=[],pSupps=[];
async function loadInvt(){invtData=await dbGet("inventory","&order=purchase_date.desc");pCodes=[...new Set(invtData.map(i=>i.item_code).filter(Boolean))];pNames=[...new Set(invtData.map(i=>i.item_name).filter(Boolean))];pSupps=[...new Set(invtData.map(i=>i.supplier).filter(Boolean))];setupPAC();renderInvt();}
function setupPAC(){const c=document.getElementById("ptCode"),n=document.getElementById("ptName"),s=document.getElementById("ptSup");if(!c.dataset.ac){attachAC(c,pCodes);c.dataset.ac="1";}if(!n.dataset.ac){attachAC(n,pNames);n.dataset.ac="1";}if(!s.dataset.ac){attachAC(s,pSupps);s.dataset.ac="1";}}
function renderInvt(){
  const q=document.getElementById("invtsrch").value.toLowerCase();const st=document.getElementById("invtSt").value;
  let f=invtData.filter(i=>(i.item_code||"").toLowerCase().includes(q)||(i.item_name||"").toLowerCase().includes(q)||(i.supplier||"").toLowerCase().includes(q)||(i.car_reg||"").toLowerCase().includes(q)||(i.serial_number||"").toLowerCase().includes(q));
  if(st)f=f.filter(i=>i.status===st);
  const tb=document.getElementById("invtTb");tb.innerHTML="";
  if(!f.length){tb.innerHTML=`<tr><td colspan="10"><div class="empty"><div class="ei">ğŸ“¦</div><p>No items found</p></div></td></tr>`;return;}
  f.forEach(it=>{
    const sc=it.status==="active"?"b-ok":it.status==="sold"?"b-wa":it.status==="damaged"?"b-er":"b-in";
    const tr=document.createElement("tr");
    tr.innerHTML=`<td><span style="font-family:monospace;font-weight:700;color:var(--ac)">${it.item_code}</span></td>
      <td><strong style="font-size:.86rem">${it.item_name}</strong>${it.notes?`<br><span style="color:#aaa;font-size:.74rem">${it.notes}</span>`:""}` +
      `</td><td style="font-size:.82rem">${it.supplier||"â€”"}</td>
      <td>${it.car_reg?`<span class="badge b-dk">${it.car_reg}</span>`:"â€”"}</td>
      <td style="font-family:monospace;font-size:.74rem;color:#aaa;max-width:100px;overflow:hidden;text-overflow:ellipsis" title="${it.vin_number||""}">${it.vin_number||"â€”"}</td>
      <td style="font-family:monospace;font-size:.78rem">${it.serial_number||"â€”"}</td>
      <td><strong style="color:var(--ac)">${fmtGBP(it.cost)}</strong></td>
      <td style="font-size:.8rem;color:#888">${fmtD(it.purchase_date)}</td>
      <td><span class="badge ${sc}">${it.status.toUpperCase()}</span></td>
      <td>
        <button class="btn btn-warning btn-sm" onclick="editPart('${it.id}')">âœï¸</button>
        <button class="btn btn-ghost btn-sm" onclick="cycleSt('${it.id}','${it.status}')">ğŸ”„</button>
        <button class="btn btn-danger btn-sm" onclick="delPart('${it.id}')">ğŸ—‘ï¸</button>
      </td>`;
    tb.appendChild(tr);
  });
}
function openNewPart(){invtEdit=null;document.getElementById("mPartTit").textContent="ğŸ“¦ Add Part";["ptCode","ptName","ptSup","ptCost","ptSN","ptReg","ptVIN","ptNotes"].forEach(id=>document.getElementById(id).value="");document.getElementById("ptDt").value=today();document.getElementById("ptStat").value="active";openM("mPart");}
function editPart(id){const it=invtData.find(x=>x.id===id);if(!it)return;invtEdit=id;document.getElementById("mPartTit").textContent="âœï¸ Edit Part";document.getElementById("ptCode").value=it.item_code||"";document.getElementById("ptName").value=it.item_name||"";document.getElementById("ptDt").value=it.purchase_date||"";document.getElementById("ptSup").value=it.supplier||"";document.getElementById("ptCost").value=it.cost||"";document.getElementById("ptStat").value=it.status||"active";document.getElementById("ptSN").value=it.serial_number||"";document.getElementById("ptReg").value=it.car_reg||"";document.getElementById("ptVIN").value=it.vin_number||"";document.getElementById("ptNotes").value=it.notes||"";openM("mPart");}
async function savePart(){const code=document.getElementById("ptCode").value.trim(),name=document.getElementById("ptName").value.trim(),dt=document.getElementById("ptDt").value,cost=document.getElementById("ptCost").value;if(!code||!name||!dt||!cost){toast("Fill required fields","er");return;}const data={item_code:code,item_name:name,purchase_date:dt,supplier:document.getElementById("ptSup").value.trim()||null,cost:parseFloat(cost),status:document.getElementById("ptStat").value,serial_number:document.getElementById("ptSN").value.trim()||null,car_reg:document.getElementById("ptReg").value.trim()||null,vin_number:document.getElementById("ptVIN").value.trim()||null,notes:document.getElementById("ptNotes").value.trim()||null};if(invtEdit){await dbUpd("inventory",invtEdit,data);toast("Updated!");}else{await dbIns("inventory",data);toast("Part added!");}closeM("mPart");loadInvt();}
async function cycleSt(id,cur){const c={active:"sold",sold:"returned",returned:"damaged",damaged:"active"};const ns=c[cur]||"active";await dbUpd("inventory",id,{status:ns});const it=invtData.find(x=>x.id===id);if(it)it.status=ns;renderInvt();toast(`â†’ ${ns}`,"in");}
function delPart(id){confirmDel("Delete this inventory item?",async()=>{await dbDel("inventory",id);invtData=invtData.filter(i=>i.id!==id);renderInvt();toast("Deleted","in");});}
function exportInvt(){const rows=[["Code","Name","Supplier","Car Reg","VIN","Serial","Cost","Date","Status","Notes"]];invtData.forEach(i=>rows.push([i.item_code,i.item_name,i.supplier||"",i.car_reg||"",i.vin_number||"",i.serial_number||"",i.cost,i.purchase_date,i.status,i.notes||""]));const csv=rows.map(r=>r.map(c=>`"${c||""}"`).join(",")).join("
");const a=document.createElement("a");a.href="data:text/csv,"+encodeURIComponent(csv);a.download="inventory.csv";a.click();}
function stockReport(){const act=invtData.filter(i=>i.status==="active").length;const sold=invtData.filter(i=>i.status==="sold").length;const cost=invtData.reduce((s,i)=>s+(i.cost||0),0);alert(`ğŸ“¦ Stock Report

In Stock: ${act}
Sold: ${sold}
Total Items: ${invtData.length}
Total Parts Value: ${fmtGBP(cost)}`);}
loadInvt();
</script></body></html>