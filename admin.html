<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DeltaV Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<!-- âœ… Supabase CDN MUST be before your script -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Montserrat', sans-serif;
  background: #f5f7fa;
}

header {
  background: #1e88e5;
  color: white;
  padding: 20px;
  font-size: 22px;
  font-weight: 600;
}

.container {
  padding: 20px;
}

.card {
  background: white;
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  transition: 0.2s;
}

.card:hover {
  transform: translateY(-3px);
}

.card h3 {
  margin-bottom: 8px;
}

.buttons {
  margin-top: 15px;
}

button {
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  margin-right: 8px;
}

.confirm {
  background: #1e88e5;
  color: white;
}

.inspect {
  background: #eee;
}
</style>
</head>

<body>

<header>DeltaV Admin Dashboard</header>

<div class="container" id="bookings"></div>

<script>
/* ===========================
   ðŸ”¹ REPLACE THESE
=========================== */
const SUPABASE_URL = "YOUR_SUPABASE_URL";
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";

/* ===========================
   ðŸ”¹ INIT
=========================== */
const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ===========================
   ðŸ”¹ FETCH BOOKINGS
=========================== */
async function fetchBookings() {

  const { data, error } = await db
    .from("bookings")
    .select("*")
    .order("id", { ascending: false });

  if (error) {
    console.error(error);
    return;
  }

  const container = document.getElementById("bookings");
  container.innerHTML = "";

  data.forEach(booking => {

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3>${booking.name}</h3>
      <p><strong>Date:</strong> ${booking.date}</p>
      <p><strong>Status:</strong> ${booking.confirmed ? "Confirmed" : "Pending"}</p>
      <div class="buttons">
        <button class="confirm" onclick="toggleConfirm(${booking.id}, ${booking.confirmed})">
          ${booking.confirmed ? "Unconfirm" : "Confirm"}
        </button>
        <button class="inspect" onclick="inspectBooking('${booking.name}', '${booking.email}', '${booking.phone}')">
          Inspect
        </button>
      </div>
    `;

    container.appendChild(card);
  });
}

/* ===========================
   ðŸ”¹ TOGGLE CONFIRM
=========================== */
async function toggleConfirm(id, currentStatus) {

  await db
    .from("bookings")
    .update({ confirmed: !currentStatus })
    .eq("id", id);

  fetchBookings();
}

/* ===========================
   ðŸ”¹ INSPECT
=========================== */
function inspectBooking(name, email, phone) {
  alert(
    "Name: " + name + "\n" +
    "Email: " + email + "\n" +
    "Phone: " + phone
  );
}

/* ===========================
   ðŸ”¹ AUTO LOAD + REFRESH
=========================== */
fetchBookings();
setInterval(fetchBookings, 5000);
</script>

</body>
</html>
