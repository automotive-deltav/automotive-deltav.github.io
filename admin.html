<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bookings - DeltaV</title>
<link rel="stylesheet" href="theme.css">
</head><body>
<script>if(sessionStorage.getItem("dv_admin")!=="1")location.href="login.html";</script>
<div class="sidebar">
  <div class="sb-logo">DeltaV <span>Auto</span><small>Management System</small></div>
  <nav><div class="sb-sec">Core</div><a href="dashboard.html"><span class="ni">ğŸ“Š</span>Dashboard</a><a href="admin.html" class="active"><span class="ni">ğŸ“…</span>Bookings</a><a href="suppliers.html"><span class="ni">ğŸ­</span>Suppliers</a><div class="sb-sec">Management</div><a href="expenses.html"><span class="ni">ğŸ§¾</span>Expenses</a><a href="notes.html"><span class="ni">ğŸ“</span>Notes</a><a href="reminders.html"><span class="ni">ğŸ””</span>Reminders</a><a href="tasks.html"><span class="ni">âœ…</span>Tasks</a><a href="vehicles.html"><span class="ni">ğŸš—</span>Vehicles</a><div class="sb-sec">Operations</div><a href="warranties.html"><span class="ni">ğŸ›¡ï¸</span>Warranties</a><a href="feedback.html"><span class="ni">â­</span>Feedback</a><a href="returns.html"><span class="ni">â†©ï¸</span>Returns</a><a href="waiting.html"><span class="ni">â³</span>Waiting List</a><a href="targets.html"><span class="ni">ğŸ¯</span>Targets</a><a href="promotions.html"><span class="ni">ğŸ</span>Promotions</a><a href="loyalty.html"><span class="ni">ğŸ…</span>Loyalty</a><a href="parts_orders.html"><span class="ni">ğŸ›’</span>Parts Orders</a><a href="checklist.html"><span class="ni">â˜‘ï¸</span>Checklists</a><a href="messages.html"><span class="ni">ğŸ’¬</span>Messages</a></nav>
  <div class="sb-foot">
    <a href="index.html" class="btn-sb-link">ğŸŒ Website</a>
    <button class="btn-sb-out" onclick="sessionStorage.removeItem('dv_admin');location.href='login.html'">ğŸšª Logout</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <h1>ğŸ“… Bookings</h1>
    <div class="tr">
      <button class="btn btn-ghost" onclick="loadData()">ğŸ”„ Refresh</button>
    </div>
  </div>
  <div class="body">
    <div style="display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap">
      <div class="srch-w"><input type="text" id="srch" placeholder="Search bookings..." oninput="renderData()"></div>
      <button class="btn btn-primary" onclick="openNew()">+ New</button>
      <button class="btn btn-info" onclick="doExport()">ğŸ“¥ Export</button>
      <button class="btn btn-ghost" onclick="loadData()">ğŸ”„</button>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px" id="cardGrid"></div>
  </div>
</div>

<div class="modal" id="mView">
  <div class="mbox">
    <h3>ğŸ“‹ Booking Details</h3>
    <div id="viewContent"></div>
    <div class="mfoot">
      <button class="btn btn-ghost" onclick="closeM('mView')">Close</button>
    </div>
  </div>
</div>

<div class="modal" id="mDel">
  <div class="mbox" style="max-width:400px">
    <h3>ğŸ—‘ï¸ Confirm Delete</h3>
    <p id="mDelMsg" style="color:#64748b">Delete this booking?</p>
    <div class="mfoot">
      <button class="btn btn-ghost" onclick="closeM('mDel')">Cancel</button>
      <button class="btn btn-danger" id="mDelBtn">Yes, Delete</button>
    </div>
  </div>
</div>

<script src="shared.js"></script>
<script>
let data=[];
async function loadData(){
  data=await dbGet("bookings","&order=date.desc");
  renderData();
}
function renderData(){
  const q=document.getElementById("srch").value.toLowerCase();
  const f=data.filter(r=>Object.values(r).some(v=>String(v||"").toLowerCase().includes(q)));
  const grid=document.getElementById("cardGrid");
  grid.innerHTML="";
  if(!f.length){
    grid.innerHTML='<div style="grid-column:1/-1;padding:60px 20px;text-align:center"><div class="empty"><div class="ei">ğŸ“…</div><h3>No bookings found</h3><p>Bookings will appear here</p></div></div>';
    return;
  }
  f.forEach(r=>{
    const statusColor=r.status==='confirmed'?'var(--ok)':r.status==='pending'?'var(--wa)':'var(--in)';
    const card=document.createElement("div");
    card.className="card";
    card.style.borderLeft="4px solid "+statusColor;
    card.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
      <div><div style="font-weight:700;color:#1b2b3a">${r.name}</div><div style="font-size:.8rem;color:#94a3b8">${r.email}</div></div>
      <span style="display:inline-block;padding:4px 8px;border-radius:4px;font-size:.7rem;font-weight:600;background:${statusColor};color:#fff">${r.status||'pending'}</span>
    </div>
    <div style="margin:12px 0;padding:12px;background:#f8f9fb;border-radius:8px">
      <div style="color:#64748b;font-size:.8rem;margin-bottom:4px">ğŸš— Vehicle</div>
      <div style="font-weight:600;color:#1b2b3a">${r.reg}</div>
      <div style="font-size:.8rem;color:#94a3b8">${r.car||'Unknown'}</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0;font-size:.85rem">
      <div><span style="color:#94a3b8">ğŸ“‹ Service</span><div style="font-weight:600;color:#1b2b3a">${r.service||'General'}</div></div>
      <div><span style="color:#94a3b8">ğŸ“… Date</span><div style="font-weight:600;color:#1b2b3a">${r.date}</div></div>
    </div>
    <div style="font-size:.85rem;margin:12px 0"><span style="color:#94a3b8">ğŸ“ Contact</span><div style="font-weight:600;color:#1b2b3a">${r.phone||'â€”'}</div></div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-primary btn-sm" onclick="viewRow('${r.id}')" style="flex:1">View</button>
      <button class="btn btn-danger btn-sm" onclick="delRow('${r.id}')">ğŸ—‘ï¸</button>
    </div>`;
    grid.appendChild(card);
  });
}
function delRow(id){
  confirmDel("Delete this booking?",async()=>{
    await dbDel("bookings",id);
    data=data.filter(x=>x.id!==id);
    renderData();
    toast("Deleted","in");
  });
}
loadData();
</script>
</body></html>