<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bookings - DeltaV</title>
<link rel="stylesheet" href="theme.css">
</head><body>
<script>if(sessionStorage.getItem("dv_admin")!=="1")location.href="login.html";</script>
<div class="sidebar">
  <div class="sb-logo">DeltaV <span>Auto</span><small>Management System</small></div>
  <nav><div class="sb-sec">Core</div><a href="dashboard.html"><span class="ni">ğŸ“Š</span>Dashboard</a><a href="admin.html" class="active"><span class="ni">ğŸ“…</span>Bookings</a><a href="suppliers.html"><span class="ni">ğŸ­</span>Suppliers</a><div class="sb-sec">Management</div><a href="expenses.html"><span class="ni">ğŸ§¾</span>Expenses</a><a href="notes.html"><span class="ni">ğŸ“</span>Notes</a><a href="reminders.html"><span class="ni">ğŸ””</span>Reminders</a><a href="tasks.html"><span class="ni">âœ…</span>Tasks</a><a href="vehicles.html"><span class="ni">ğŸš—</span>Vehicles</a><div class="sb-sec">Operations</div><a href="warranties.html"><span class="ni">ğŸ›¡ï¸</span>Warranties</a><a href="feedback.html"><span class="ni">â­</span>Feedback</a><a href="returns.html"><span class="ni">â†©ï¸</span>Returns</a><a href="waiting.html"><span class="ni">â³</span>Waiting List</a><a href="targets.html"><span class="ni">ğŸ¯</span>Targets</a><a href="promotions.html"><span class="ni">ğŸ</span>Promotions</a><a href="loyalty.html"><span class="ni">ğŸ…</span>Loyalty</a><a href="parts_orders.html"><span class="ni">ğŸ›’</span>Parts Orders</a><a href="checklist.html"><span class="ni">â˜‘ï¸</span>Checklists</a><a href="messages.html"><span class="ni">ğŸ’¬</span>Messages</a></nav>
  <div class="sb-foot">
    <a href="index.html" class="btn-sb-link">ğŸŒ Website</a>
    <button class="btn-sb-out" onclick="sessionStorage.removeItem('dv_admin');location.href='login.html'">ğŸšª Logout</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <h1>ğŸ“… Bookings</h1>
    <div class="tr">
      <button class="btn btn-ghost" onclick="loadData()">ğŸ”„ Refresh</button>
    </div>
  </div>
  <div class="body">
    <div class="tbl-wrap">
      <table>
        <thead>
          <tr>
            <th>Customer</th>
            <th>Vehicle</th>
            <th>Service</th>
            <th>Date</th>
            <th>Phone</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal" id="mView">
  <div class="mbox">
    <h3>ğŸ“‹ Booking Details</h3>
    <div id="viewContent"></div>
    <div class="mfoot">
      <button class="btn btn-ghost" onclick="closeM('mView')">Close</button>
    </div>
  </div>
</div>

<div class="modal" id="mDel">
  <div class="mbox" style="max-width:400px">
    <h3>ğŸ—‘ï¸ Confirm Delete</h3>
    <p id="mDelMsg" style="color:#64748b">Delete this booking?</p>
    <div class="mfoot">
      <button class="btn btn-ghost" onclick="closeM('mDel')">Cancel</button>
      <button class="btn btn-danger" id="mDelBtn">Yes, Delete</button>
    </div>
  </div>
</div>

<script src="shared.js"></script>
<script>
let data=[];
async function loadData(){
  data=await dbGet("bookings","&order=date.desc");
  renderData();
}
function renderData(){
  const tb=document.getElementById("tbody");
  if(!data.length){
    tb.innerHTML='<tr><td colspan="7"><div class="empty"><div class="ei">ğŸ“…</div><h3>No bookings yet</h3><p>Bookings from customers will appear here</p></div></td></tr>';
    return;
  }
  tb.innerHTML=data.map(r=>{
    const statusColor=r.status==='confirmed'?'var(--ok)':'var(--wa)';
    return `<tr>
      <td><strong>${r.name}</strong><br><small style="color:#94a3b8">${r.email}</small></td>
      <td><strong>${r.reg}</strong><br><small style="color:#94a3b8">${r.car||'â€”'}</small></td>
      <td>${r.service||'General'}</td>
      <td>${r.date}</td>
      <td>${r.phone||'â€”'}</td>
      <td><span style="display:inline-block;padding:4px 10px;border-radius:6px;font-size:.75rem;font-weight:600;background:${statusColor};color:#fff">${r.status||'pending'}</span></td>
      <td>
        <button class="btn btn-info btn-sm" onclick="viewRow('${r.id}')">ğŸ‘ï¸ View</button>
        <button class="btn btn-danger btn-sm" onclick="confirmDel('Delete this booking?',()=>deleteRow('${r.id}'))">ğŸ—‘ï¸</button>
      </td>
    </tr>`;
  }).join('');
}
function viewRow(id){
  const r=data.find(x=>x.id===id);
  if(!r)return;
  document.getElementById("viewContent").innerHTML=`
    <div style="display:grid;gap:16px">
      <div><strong>Customer:</strong> ${r.name}</div>
      <div><strong>Email:</strong> ${r.email}</div>
      <div><strong>Phone:</strong> ${r.phone||'â€”'}</div>
      <div><strong>Vehicle:</strong> ${r.reg} ${r.car||''} ${r.year||''}</div>
      <div><strong>Service:</strong> ${r.service||'General'}</div>
      <div><strong>Date:</strong> ${r.date}</div>
      <div><strong>Status:</strong> ${r.status||'pending'}</div>
      <div><strong>Notes:</strong> ${r.notes||'None'}</div>
    </div>
  `;
  openM("mView");
}
async function deleteRow(id){
  try{
    await dbDel("bookings",id);
    data=data.filter(x=>x.id!==id);
    renderData();
    showToast("Booking deleted!","success");
  }catch(e){alert("Failed to delete");}
}
loadData();
</script>
</body></html>